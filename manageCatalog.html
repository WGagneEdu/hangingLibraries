<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modify Member - Staff Access</title>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI", Tahoma, sans-serif;}

    body{
      background-image:url("peakpx.jpg");
      background-size:cover;
      background-position:center;
      min-height:100vh;
    }

    /* NAVBAR */
    .navbar{
      display:flex;
      justify-content:space-around;
      align-items:center;
      background:rgba(255,255,255,0.85);
      backdrop-filter:blur(8px);
      padding:15px 0;
      border-bottom:2px solid #ccc;
      position:fixed;
      top:0;
      width:100%;
      z-index:10;
    }

    .nav-btn{
      background:#EAEAEA;
      padding:8px 20px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      transition:0.3s;
    }
    .nav-btn:hover{background:#d6d6d6;}

    .title{
      margin-top:130px;
      text-align:center;
      background:#8A4F2A;
      color:white;
      padding:12px 30px;
      border-radius:28px;
      width:max-content;
      margin-left:auto;
      margin-right:auto;
      font-size:22px;
      font-weight:600;
    }

    .container{
      background:rgba(255,255,255,0.9);
      padding:30px;
      margin:40px auto;
      width:85%;
      max-width:700px;
      border-radius:14px;
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }

    h3{
      font-size:20px;
      font-weight:600;
      color:#8A4F2A;
      margin-bottom:15px;
    }

    label{
      font-weight:600;
      margin-top:15px;
      display:block;
    }

    input,select{
      width:100%;
      padding:12px;
      border:1px solid #ccc;
      border-radius:8px;
      margin-top:8px;
    }

    .btn{
      background:#8A4F2A;
      color:white;
      border:none;
      padding:12px;
      border-radius:10px;
      margin-top:20px;
      width:100%;
      font-size:16px;
      cursor:pointer;
    }
    .btn:hover{background:#6f3f23;}

    .lookup-btn{
      background:#8A4F2A;
      padding:10px 18px;
      border-radius:8px;
      color:white;
      border:none;
      cursor:pointer;
      margin-top:10px;
    }

    .row{display:flex;gap:12px;}
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <div class="navbar">
    <button class="nav-btn" onclick="location.href='homePage.html'">üèõ HOME</button>
    <button class="nav-btn" onclick="location.href='searchPage.html'">üîç SEARCH</button>
    <button class="nav-btn" onclick="location.href='browsePage.html'">‚ò∞ BROWSE</button>
    <button class="nav-btn" onclick="location.href='editProfilePage.html'">üë§ PROFILE</button>
    <button class="nav-btn" onclick="location.href='staffPage.html'">üõ† STAFF</button>
    <button class="nav-btn" id="loginLogoutBtn">üîê LOGIN</button>
  </div>

  <div class="title">MODIFY MEMBER</div>

  <div class="container">

    <h3>Search Member</h3>

    <label>Search by Username or Member ID</label>
    <input type="text" id="lookupInput" placeholder="Enter username or member ID">

    <button class="lookup-btn" onclick="lookupMember()">Lookup</button>


    <!-- FORM -->
    <h3 style="margin-top:30px;">Member Details</h3>

    <label>Full Name</label>
    <input type="text" id="fullName">

    <label>Email</label>
    <input type="text" id="email">

    <label>Phone</label>
    <input type="text" id="phone">

    <label>Address</label>
    <input type="text" id="address">

    <label>Membership Status</label>
    <select id="status">
      <option>Active</option>
      <option>Suspended</option>
      <option>Expired</option>
    </select>

    <label>Expiration Date</label>
    <input type="date" id="expiration">

    <label>Account Role</label>
    <select id="role">
      <option value="member">Member</option>
      <option value="staff">Staff</option>
    </select>

    <label>Account Balance</label>
    <input type="number" step="0.01" id="balance">

    <button class="btn" onclick="saveChanges()">Save Changes</button>

  </div>


<script>
/* ==========================================================
   SECURITY ‚Äî REQUIRE LOGIN & STAFF ROLE
========================================================== */
if (!localStorage.getItem("sessionUser")) {
  alert("Please log in first.");
  window.location.href = "loginPage.html";
}

if (localStorage.getItem("sessionRole") !== "staff") {
  alert("You do not have permission to access staff tools.");
  window.location.href = "homePage.html";
}

/* ==========================================================
   NAVBAR LOGIN LOGOUT
========================================================== */
const loginBtn = document.getElementById("loginLogoutBtn");
loginBtn.textContent = localStorage.getItem("sessionUser") ? "üö™ LOGOUT" : "üîê LOGIN";

loginBtn.onclick = () => {
  if (localStorage.getItem("sessionUser")) {
    localStorage.clear();
    alert("Logged out.");
  }
  window.location.href = "loginPage.html";
};


/* ==========================================================
   LOOKUP MEMBER FROM DATABASE
========================================================== */
async function lookupMember() {
  const input = document.getElementById("lookupInput").value.trim();
  if (!input) return alert("Enter a username or member ID.");

  const response = await fetch(`/getMember?identifier=${input}`);
  const data = await response.json();

  if (!data.success) {
    alert("Member not found.");
    return;
  }

  const u = data.member;

  document.getElementById("fullName").value = u.fullName || "";
  document.getElementById("email").value = u.email || "";
  document.getElementById("phone").value = u.phone || "";
  document.getElementById("address").value = u.address || "";
  document.getElementById("status").value = u.membershipStatus || "Active";
  document.getElementById("expiration").value = u.membershipExpiration || "";
  document.getElementById("role").value = u.role || "member";
  document.getElementById("balance").value = u.balance || 0;
}


/* ==========================================================
   SAVE UPDATED MEMBER BACK TO DATABASE
========================================================== */
async function saveChanges() {
  const payload = {
    identifier: document.getElementById("lookupInput").value.trim(),
    fullName: document.getElementById("fullName").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
    address: document.getElementById("address").value,
    status: document.getElementById("status").value,
    expiration: document.getElementById("expiration").value,
    role: document.getElementById("role").value,
    balance: document.getElementById("balance").value
  };

  const res = await fetch("/updateMember", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  const data = await res.json();

  if (data.success) {
    alert("Member updated successfully!");
  } else {
    alert("Update failed.");
  }
}
</script>

</body>
</html>
