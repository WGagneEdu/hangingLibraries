<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkouts â€“ Hanging Libraries</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="navbar">
  <button class="nav-btn" onclick="location.href='index.html'">ğŸ› HOME</button>
  <button class="nav-btn" onclick="location.href='search.html'">ğŸ” SEARCH</button>
  <button class="nav-btn" onclick="location.href='browse.html'">â˜° BROWSE</button>
  <button class="nav-btn" onclick="location.href='staff.html'">ğŸ›  STAFF DASHBOARD</button>
  <button class="nav-btn" id="loginLogoutBtn">ğŸ” LOGIN</button>
</div>

<div class="page-title">ACTIVE CHECKOUTS</div>

<div class="content-card" id="checkoutList">
  <p>Loading checkouts...</p>
</div>

<script src="app.js"></script>
<script>
staffGuard();

document.addEventListener("DOMContentLoaded", () => {
  setupNavbar();
  loadCheckouts();
});

// Check out 
function renderCheckoutItem(c) {
  return `
    <div class="checkout-item">
      <div>
        <strong>${c.Title}</strong>
        <div class="meta">
          ISBN: ${c.ISBN}<br>
          Member: ${c.First_Name} ${c.Last_Name} (ID: ${c.Member_IDNum})<br>
          Due: ${c.Due_Date}
        </div>
      </div>
      <button class="btn-small" data-logid="${c.Log_ID}">
        Mark Returned
      </button>
    </div>
  `;
}

//Load Check Outs
async function loadCheckouts() {
  const container = document.getElementById("checkoutList");
  const data = await apiGET("/api/staff/checkouts");

  container.innerHTML = "";

  if (!data.success || !data.items || data.items.length === 0) {
    container.innerHTML = "<p>No active checkouts.</p>";
    return;
  }

  container.innerHTML = data.items.map(renderCheckoutItem).join("");

  container.querySelectorAll("button[data-logid]").forEach(btn => {
    btn.addEventListener("click", () => {
      markReturned(btn.dataset.logid);
    });
  });
}

//Return Book
async function markReturned(logId) {
  if (!confirm("Mark this item as returned?")) return;

  const data = await apiPOST("/api/staff/checkout/return", { logId });

  if (data.success) {
    loadCheckouts();
  } else {
    alert("Failed to mark returned.");
  }
}
</script>

</body>
</html>
