<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Catalog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="navbar">
  <button class="nav-btn" onclick="location.href='index.html'">üèõ HOME</button>
  <button class="nav-btn" onclick="location.href='staff.html'">üõ† STAFF</button>
</div>

<div class="page-title">MANAGE CATALOG</div>

<div class="content-card">
  <!-- ISBN SEARCH -->
  <div class="form-group">
    <label>Search ISBN</label>
    <input id="searchISBN" type="text">
    <button class="primary-btn" onclick="loadBook()">Load</button>
  </div>

  <hr>

  <!-- BOOK INFO -->
  <div class="form-group">
    <label>ISBN</label>
    <input id="isbn">
  </div>

  <div class="form-group">
    <label>Title</label>
    <input id="title">
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>Author First</label>
      <input id="authorFirst">
    </div>
    <div class="form-group">
      <label>Author Last</label>
      <input id="authorLast">
    </div>
  </div>

  <div class="form-group">
    <label>Publisher</label>
    <input id="publisher">
  </div>

  <div class="form-group">
    <label>Date Published</label>
    <input id="pubDate" type="date">
  </div>

  <div class="form-group">
    <label>Book Home</label>
    <input id="bookHome">
  </div>

  <div class="form-group">
    <label>Inventory</label>
    <input id="inventory" type="number">
  </div>

  <!-- ‚úÖ COVER IMAGE -->
  <div class="form-group">
    <label>Cover Image</label>

    <div style="text-align:center; margin-bottom:10px;">
      <img
        id="coverPreview"
        src="/images/noimg.jpeg"
        alt="Cover Preview"
        style="max-width:160px; max-height:220px; border-radius:6px; border:1px solid #ccc;"
      >
    </div>

    <input id="cover" type="file" accept="image/*">
  </div>

  <button class="primary-btn" onclick="saveBook()">Save Book</button>
</div>

<script>
const preview = document.getElementById("coverPreview");

/* ================= LOAD BOOK BY ISBN ================= */
async function loadBook() {
  const isbnVal = searchISBN.value.trim();
  if (!isbnVal) return;

  const res = await fetch(`/api/staff/book?isbn=${encodeURIComponent(isbnVal)}`);
  const data = await res.json();

  if (!data.success || !data.book) {
    alert("Book not found");
    preview.src = "/images/noimg.jpeg";
    return;
  }

  const b = data.book;

  isbn.value = b.ISBN;
  title.value = b.Title;
  authorFirst.value = b.Author_fName;
  authorLast.value = b.Author_lName;
  publisher.value = b.Publisher || "";
  pubDate.value = b.Date_Published ? b.Date_Published.substring(0,10) : "";
  bookHome.value = b.Book_Home;
  inventory.value = b.Book_inventory;

  // ‚úÖ Load cover or fallback
  preview.src = b.coverImage ? `/api/book/cover/${b.ISBN}` : "/images/noimg.jpeg";
}

/* ================= SAVE BOOK ================= */
async function saveBook() {
  const fd = new FormData();

  fd.append("isbn", isbn.value.trim());
  fd.append("title", title.value.trim());
  fd.append("authorFirst", authorFirst.value.trim());
  fd.append("authorLast", authorLast.value.trim());
  fd.append("publisher", publisher.value.trim());
  fd.append("pubDate", pubDate.value);
  fd.append("bookHome", bookHome.value.trim());
  fd.append("inventory", inventory.value);

  // ‚úÖ If no file selected, default image is used automatically
  if (cover.files.length > 0) {
    fd.append("cover", cover.files[0]);
  }

  const res = await fetch("/api/staff/book/save", {
    method: "POST",
    body: fd
  });

  const data = await res.json();
  alert(data.success ? "Book saved" : "Save failed");
}

/* ================= PREVIEW IMAGE ON SELECT ================= */
cover.addEventListener("change", () => {
  if (cover.files.length === 0) return;
  preview.src = URL.createObjectURL(cover.files[0]);
});
</script>

</body>
</html>
