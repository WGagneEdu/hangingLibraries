<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Members</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="navbar">
  <button class="nav-btn" onclick="location.href='index.html'">üèõ HOME</button>
  <button class="nav-btn" onclick="location.href='staff.html'">üõ† STAFF</button>
</div>

<div class="page-title">MANAGE MEMBERS</div>

<div class="content-card">

  <!-- MEMBER LOOKUP -->
  <div class="form-group">
    <label for="searchMember">Member ID</label>
    <input id="searchMember" type="number">
    <button class="primary-btn" onclick="lookupMember()">Load</button>
  </div>

  <hr>

  <!-- MEMBER DATA -->
  <div class="form-group">
    <label>Member ID</label>
    <input id="memberId" disabled>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>First Name</label>
      <input id="firstName">
    </div>

    <div class="form-group">
      <label>Last Name</label>
      <input id="lastName">
    </div>
  </div>

  <div class="form-group">
    <label>Date of Birth</label>
    <input id="dob" type="date">
  </div>

  <div class="form-group">
    <label>Street Address</label>
    <input id="street">
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>City</label>
      <input id="city">
    </div>

    <div class="form-group">
      <label>State</label>
      <input id="state">
    </div>

    <div class="form-group">
      <label>Zip Code</label>
      <input id="zip">
    </div>
  </div>

  <button class="primary-btn" onclick="saveMember()">Save Changes</button>
</div>

<script>
const searchMember = document.getElementById("searchMember");
const memberId     = document.getElementById("memberId");
const firstName    = document.getElementById("firstName");
const lastName     = document.getElementById("lastName");
const dob          = document.getElementById("dob");
const street       = document.getElementById("street");
const city         = document.getElementById("city");
const state        = document.getElementById("state");
const zip          = document.getElementById("zip");

/* ===== LOAD MEMBER ===== */
async function lookupMember() {
  const id = searchMember.value.trim();
  if (!id) return;

  const res = await fetch(`/api/staff/member/${encodeURIComponent(id)}`);
  const data = await res.json();

  if (!data.success) {
    alert("Member not found");
    return;
  }

  const m = data.member;

  memberId.value = m.MEMBER_IDNum;
  firstName.value = m.First_Name;
  lastName.value = m.Last_Name;
  dob.value = m.Date_of_Birth ? m.Date_of_Birth.substring(0, 10) : "";
  street.value = m.Street_Address;
  city.value = m.City;
  state.value = m.State;
  zip.value = m.Zip_Code;
}

/* ===== SAVE MEMBER ===== */
async function saveMember() {
  if (!memberId.value) return;

  const res = await fetch("/api/staff/member/save", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      memberId: memberId.value,
      firstName: firstName.value,
      lastName: lastName.value,
      dob: dob.value,
      street: street.value,
      city: city.value,
      state: state.value,
      zip: zip.value
    })
  });

  const data = await res.json();
  alert(data.success ? "Member updated" : "Update failed");
}
</script>

</body>
</html>
